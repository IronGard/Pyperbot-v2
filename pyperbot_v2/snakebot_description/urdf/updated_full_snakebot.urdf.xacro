<?xml version="1.0" encoding="UTF-8"?>
<!-- Add macros and normalisation for prismatic joints-->
<robot xmlns:xacro = "http://www.ros.org/wiki/xacro" name = "full_snakebot">
    <!-- Define colors -->
    <material name = "white">
        <color rgba = "1 1 1 1"/>
    </material>
    <material name = "black">
        <color rgba = "0 0 0 1"/>
    </material>

    <!-- Define head link -->
    <link name = "head">
        <inertial>
            <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
            <mass value = "1"/>
            <inertia ixx = "0.0001" ixy = "0" ixz = "0" iyy = "0.0001" iyz = "0" izz = "0.0001"/>  
        </inertial>
        <visual>
            <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
            <geometry>
                <sphere radius = "0.05"/>
            </geometry>
            <material name = "black"/>
        </visual>
        <collision>
            <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
            <geometry>
                <sphere radius = "0.05"/>
            </geometry>
        </collision>
    </link>
    <link name = "m0_base_link">
        <visual>
            <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
            <geometry>
                <cylinder radius = "0.05" length = "0.02"/>
            </geometry>
            <material name = "${color}"/>
        </visual>
    </link>
    <joint name = "head_to_m0" type = "fixed">
        <parent link = "head"/>
        <child link = "m0_base_link"/>
        <origin xyz = "0.0275 0 0"/>
    </joint>

    <!-- Module Definition -->
    <xacro:macro name = "module" params = "number color">
        <!-- Bottom bracket -->
        <link name = "m${number}_bottom_bracket">
            <visual>
                <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
                <geometry>
                    <cylinder radius = "0.05" length = "0.045"/>
                </geometry>
                <material name = "${color}"/>
            </visual>
            <collision>
                <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
                <geometry>
                    <cylinder radius = "0.05" length = "0.045"/>
                </geometry>
            </collision>
            <inertial>
                <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
                <mass value = "0.1"/>
                <inertia ixx = "0.0001" ixy = "0" ixz = "0" iyy = "0.0001" iyz = "0" izz = "0.0001"/>  
            </inertial>
        </link>
        <!-- Bottom bracket (virtual link 0) -->
        <link name = "m${number}_virtual_link_zero"></link>
        <!-- Bottom bracket (virtual link 1) -->
        <link name = "m${number}_virtual_link_one"></link>

        <!-- Middle bracket -->
        <link name = "m${number}_middle_bracket">
            <visual>
                <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
                <geometry>
                    <cylinder radius = "0.05" length = "0.085"/>
                </geometry>
                <material name = "${color}"/>
            </visual>
            <collision>
                <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
                <geometry>
                    <cylinder radius = "0.05" length = "0.07"/>
                </geometry>
            </collision>
            <inertial>
                <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
                <mass value = "0.1"/>
                <inertia ixx = "0.0001" ixy = "0" ixz = "0" iyy = "0.0001" iyz = "0" izz = "0.0001"/>
            </inertial>
        </link>
        <!-- Middle bracket (virtual link 2) -->
        <link name = "m${number}_virtual_link_two"></link>

        <!-- Top bracket -->
        <link name = "m${number}_top_bracket">
            <visual>
                <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
                <geometry>
                    <cylinder radius = "0.05" length = "0.055"/>
                </geometry>
                <material name = "${color}"/>
            </visual>
            <!-- Collision - only for the top half! -->
            <collision>
                <origin rpy = "0 1.5708 0" xyz = "0.025 0 0"/>
                <geometry>
                    <cylinder radius = "0.05" length = "0.055"/>
                </geometry>
            </collision>
            <inertial>
                <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
                <mass value = "0.1"/>
                <inertia ixx = "0.0001" ixy = "0" ixz = "0" iyy = "0.0001" iyz = "0" izz = "0.0001"/>
            </inertial>
        </link>
        <!-- Top bracket (virtual link 3)-->
        <link name = "m${number}_virtual_link_three"/>

        <!-- Module joints -->
        <!-- Joint 0 -->
        <joint name = "m${number}_joint_zero" type = "prismatic">
            <parent link = "m${number}_base_link"/>
            <child link = "m${number}_bottom_bracket"/>
            <axis xyz = "1 0 0"/>
            <limit lower = "0" upper = "0.02" effort = "1" velocity = "0.01"/>
            <origin rpy = "0 0 0" xyz = "0 0 0"/>
            <dynamics damping = "0.0" friction = "0.01"/>
        </joint>
        
        <!-- Joint 1 -->
        <joint name = "m${number}_joint_one" type = "revolute">
            <parent link = "m${number}_bottom_bracket"/>
            <child link = "m${number}_virtual_link_zero"/>
            <axis xyz = "0 0 1"/>
            <limit lower = "-0.0873" upper = "0.0873" effort = "1" velocity = "0.01"/>
        </joint>

        <!-- Joint 2 -->
        <joint name = "m${number}_joint_two" type = "revolute">
            <parent link = "m${number}_virtual_link_zero"/>
            <child link = "m${number}_virtual_link_one"/>
            <axis xyz = "1 0 0"/>
            <limit lower = "-0.2618" upper = "0.2618" effort = "1" velocity = "0.01"/>
            <origin xyz = "0.02 0 0"/>
        </joint>

        <!-- Fixed joint (linking cross-joint and spring-stell) -->
        <joint name = "m${number}_fix_one" type = "fixed">
            <parent link = "m${number}_virtual_link_one"/>
            <child link = "m${number}_middle_bracket"/>
            <origin rpy = "0 0 0" xyz = "0.045 0 0"/>
        </joint>
        <joint name = "m${number}_fix_two" type = "fixed">
            <parent link = "m${number}_middle_bracket"/>
            <child link = "m${number}_virtual_link_two"/>
            <origin rpy = "0 0 0" xyz = "0.015 0 0"/>
        </joint>

        <!-- Joint 3 -->
        <joint name = "m${number}_joint_three" type = "revolute">
            <parent link = "m${number}_virtual_link_two"/>
            <child link = "m${number}_virtual_link_three"/>
            <axis xyz = "0 0 1"/>
            <limit lower = "-0.5236" upper = "0.5236" effort = "1" velocity = "0.01"/>
            <origin rpy = "0 0 0" xyz = "0 0 0"/>
        </joint>

        <!-- Joint 4 -->
        <joint name = "m${number}_joint_four" type = "revolute">
            <parent link = "m${number}_virtual_link_three"/>
            <child link = "m${number}_top_bracket"/>
            <axis xyz = "0 1 0"/>
            <limit lower = "-0.5236" upper = "0.5236" effort = "1" velocity = "0.01"/>
            <origin rpy = "0 0 0" xyz = "0.055 0 0"/>
        </joint>
    </xacro:macro>

    
    <!-- Initiate modules -->
    <xacro:module number = "0" color = "white"/>
    <!-- m1 base link -->
    <link name = "m1_base_link">
        <visual>
            <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
            <geometry>
                <cylinder radius = "0.05" length = "0.02"/>
            </geometry>
            <material name = "black"/>
        </visual>
    </link>
    <joint name = "m0_to_m1" type = "fixed">
        <parent link = "m0_top_bracket"/>
        <child link = "m1_base_link"/>
        <origin xyz = "0.0275 0 0"/>
    </joint>
    <xacro:module number = "1" color = "black"/>
    <!-- m2 base link -->
    <link name = "m2_base_link">
        <visual>
            <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
            <geometry>
                <cylinder radius = "0.05" length = "0.02"/>
            </geometry>
            <material name = "white"/>
        </visual>
    </link>
    <joint name = "m1_to_m2" type = "fixed">
        <parent link = "m1_top_bracket"/>
        <child link = "m2_base_link"/>
        <origin xyz = "0.0275 0 0"/>
    </joint>
    <xacro:module number = "2" color = "white"/>
    <!-- m3 base link -->
    <link name = "m3_base_link">
        <visual>
            <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
            <geometry>
                <cylinder radius = "0.05" length = "0.02"/>
            </geometry>
            <material name = "black"/>
        </visual>
    </link>
    <joint name = "m2_to_m3" type = "fixed">
        <parent link = "m2_top_bracket"/>
        <child link = "m3_base_link"/>
        <origin xyz = "0.0275 0 0"/>
    </joint>
    <xacro:module number = "3" color = "black"/>
    <!-- Define tail link -->
    <link name = "tail">
        <visual>
            <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
            <geometry>
                <cylinder radius = "0.03" length = "0.1"/>
            </geometry>
            <material name = "white"/>
        </visual>
        <collision>
            <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
            <geometry>
                <cylinder radius = "0.03" length = "0.1"/>
            </geometry>
        </collision>
        <inertial>
            <origin rpy = "0 1.5708 0" xyz = "0 0 0"/>
            <mass value = "1"/>
            <inertia ixx = "0.0001" ixy = "0" ixz = "0" iyy = "0.0001" iyz = "0" izz = "0.0001"/>
        </inertial>
    </link>
    <!-- Connect modules -->
    <joint name = "m3_to_tail" type = "fixed">
        <parent link = "m3_top_bracket"/>
        <child link = "tail"/>
        <origin xyz = "0.0275 0 0"/>
    </joint>
</robot>